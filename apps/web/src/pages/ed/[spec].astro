---
import { type Document, type EntryWithConfig } from "@openuji/speculator";
import { loadDocument, listSortedSpecs } from "@/lib/load";
import BlockRenderer from "@/components/astro/BlockRenderer.astro";
import SpecLayout from "@/layouts/SpecLayout.astro";

export async function getStaticPaths() {
  const specs = await listSortedSpecs();

  return specs.entries.map((spec: EntryWithConfig) => ({
    params: {
      spec: spec.config.id,
    },
    props: {
      id: spec.config.id,
      title: spec.config.title,
    },
  }));
}

const { id, title } = Astro.props;

const document: Document = await loadDocument(id);
---

<SpecLayout
  title={title}
  parent={{ href: "/ed", title: "Editor's Draft" }}
  toc={document.computed?.toc || []}
>
  <article class="spec">
    <h1>{title}</h1>
    {
      document.children.map((child) => (
        <BlockRenderer
          node={child}
          documentPath={document.sourcePos?.file}
          headingNumbers={document.computed?.headingNumbers}
        />
      ))
    }
  </article></SpecLayout
>
